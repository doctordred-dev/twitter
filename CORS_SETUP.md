# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## üîß –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –∑–∞–¥–µ–ø–ª–æ–µ–Ω–Ω—ã–º –±—ç–∫–µ–Ω–¥–æ–º –≤–æ–∑–Ω–∏–∫–∞—é—Ç CORS –æ—à–∏–±–∫–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (—Ñ—Ä–æ–Ω—Ç –Ω–∞ localhost)

–î–æ–±–∞–≤—å –≤ —Å–≤–æ–π `.env` —Ñ–∞–π–ª (–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ):

```bash
CORS_ORIGIN=http://localhost:3000,http://localhost:3001
```

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥:

```bash
npm run dev
```

### 2. –ü—Ä–æ–¥–∞–∫—à–Ω (—Ñ—Ä–æ–Ω—Ç –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Vercel/Netlify/–¥—Ä—É–≥–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ)

–ù–∞ Render.com –¥–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. –ó–∞–π–¥–∏ –≤ —Å–≤–æ–π Web Service –Ω–∞ Render
2. –ü–µ—Ä–µ–π–¥–∏ –≤ **Environment**
3. –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **Key**: `CORS_ORIGIN`
   - **Value**: `https://—Ç–≤–æ–π-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥.vercel.app,http://localhost:3000`

–ù–µ—Å–∫–æ–ª—å–∫–æ origins —Ä–∞–∑–¥–µ–ª—è–π –∑–∞–ø—è—Ç—ã–º–∏ (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏–ª–∏ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ - –∫–æ–¥ –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç).

### 3. –ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π CORS_ORIGIN:

**–¢–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–∫—à–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:**
```
CORS_ORIGIN=https://twitter-clone.vercel.app
```

**–ü—Ä–æ–¥–∞–∫—à–Ω + –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**
```
CORS_ORIGIN=https://twitter-clone.vercel.app,http://localhost:3000
```

**–ù–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–µ–Ω–æ–≤:**
```
CORS_ORIGIN=https://twitter-clone.vercel.app,https://twitter-clone-staging.vercel.app,http://localhost:3000
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CORS

### –ß–µ—Ä–µ–∑ curl:

```bash
curl -X POST https://twitter-bny4.onrender.com/auth/login \
  -H "Content-Type: application/json" \
  -H "Origin: http://localhost:3000" \
  -d '{"emailOrUsername":"testuser","password":"testpass"}' \
  -v
```

–ï—Å–ª–∏ –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç header:
```
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Credentials: true
```

### –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (Console):

```javascript
fetch('https://twitter-bny4.onrender.com/health', {
  credentials: 'include'
})
  .then(r => r.json())
  .then(console.log)
  .catch(console.error);
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ!

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π `credentials: 'include'`** –≤ fetch –∑–∞–ø—Ä–æ—Å–∞—Ö:
   ```javascript
   fetch(url, {
     credentials: 'include', // ‚Üê —ç—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è cookies
     headers: {
       'Authorization': `Bearer ${token}`
     }
   })
   ```

2. **–ù–µ –∑–∞–±—É–¥—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`

3. **–ù–∞ Render –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π** —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è

## üêõ –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –û—à–∏–±–∫–∞: "Access to fetch has been blocked by CORS policy"

**–ü—Ä–∏—á–∏–Ω–∞**: –¢–≤–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–º–µ–Ω –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `CORS_ORIGIN`

**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å —Ç–æ—á–Ω—ã–π URL —Ç–≤–æ–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–≤–∫–ª—é—á–∞—è –ø—Ä–æ—Ç–æ–∫–æ–ª `http://` –∏–ª–∏ `https://`)
2. –î–æ–±–∞–≤—å –µ–≥–æ –≤ `CORS_ORIGIN` –Ω–∞ Render
3. –î–æ–∂–¥–∏—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ (~2-3 –º–∏–Ω—É—Ç—ã)

### –û—à–∏–±–∫–∞: "No 'Access-Control-Allow-Credentials' header is present"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ –ø–µ—Ä–µ–¥–∞—ë—à—å `credentials: 'include'` –≤ fetch

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤—å —ç—Ç–æ –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ –±—ç–∫–µ–Ω–¥—É

### –û—à–∏–±–∫–∞: Cookies –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞ 1**: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (httpOnly cookies —Ç—Ä–µ–±—É—é—Ç HTTPS)
**–ü—Ä–∏—á–∏–Ω–∞ 2**: –ù–µ –ø–µ—Ä–µ–¥–∞—ë—à—å `credentials: 'include'`

**–†–µ—à–µ–Ω–∏–µ**: 
- –ò—Å–ø–æ–ª—å–∑—É–π HTTPS –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–π `credentials: 'include'`

**–í–∞–∂–Ω–æ**: –ë—ç–∫–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω—É–∂–Ω–æ –ª–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `Secure` —Ñ–ª–∞–≥:
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∏–¥—ë—Ç —Å `localhost` ‚Üí `Secure: false` (—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTP)
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∏–¥—ë—Ç —Å –ø—Ä–æ–¥–∞–∫—à–Ω –¥–æ–º–µ–Ω–∞ ‚Üí `Secure: true` (—Ç—Ä–µ–±—É–µ—Ç HTTPS)

## üìù –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ fetch wrapper:

```typescript
// lib/api.ts
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'https://twitter-bny4.onrender.com';

export async function apiFetch(endpoint: string, options: RequestInit = {}) {
  const url = `${API_URL}${endpoint}`;
  
  const response = await fetch(url, {
    ...options,
    credentials: 'include', // ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
    headers: {
      'Content-Type': 'application/json',
      ...options.headers,
    },
  });

  if (!response.ok) {
    const error = await response.json().catch(() => ({ error: 'Unknown error' }));
    throw new Error(error.error || `HTTP ${response.status}`);
  }

  return response.json();
}
```

## üéØ Checklist –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CORS:

- [ ] `CORS_ORIGIN` —Å–æ–¥–µ—Ä–∂–∏—Ç URL —Ç–≤–æ–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- [ ] URL –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `http://` –∏–ª–∏ `https://`
- [ ] –ù–µ—Ç –ª–∏—à–Ω–∏—Ö —Å–ª—ç—à–µ–π –≤ –∫–æ–Ω—Ü–µ URL
- [ ] –ë—ç–∫–µ–Ω–¥ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—à—å `credentials: 'include'` –≤–æ –≤—Å–µ—Ö fetch –∑–∞–ø—Ä–æ—Å–∞—Ö
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—á–Ω—ã–π URL –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTPS

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å CORS –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üéâ

